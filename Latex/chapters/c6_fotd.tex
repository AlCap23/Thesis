%!TEX root = ../studentischeArbeiten.tex
\chapter{Control of Simple Multivariable Processes}
\label{c:fotd}

The following chapter gives several examples to decouple a FOTD transfer function matrix. The process is explained with all three method to design multivariable controller. \\

In Sec.\ref{c:fotd:s:analytic} the analytic description of the methods are given, followed by the example taken from literature in Sec. \ref{c:fotd:s:rosenbrook} and Sec.\ref{c:fotd:s:woodberry}.\\

\section{Analytic Decoupling}
\label{c:fotd:s:analytic}

Since a FOTD are the model structure choosen for this work a deeper investigation of transfer function matrices based on this model is performed. For the following section a simple two input two output model given as following is defined:

\begin{align}
\begin{split}
\ma{G} = \begin{bmatrix}
g_{11} & g_{12} \\
g_{21} & g_{22}
\end{bmatrix} & ~,g_{ij} = \frac{K_{ij}}{T_{ij} s +1 } e^{-L_{ij}s}
\end{split}
\label{c:fotd:e:examplesys}
\end{align}

For the system described in Eq. \ref{c:fotd:e:examplesys} three different controller based on PI-structure are defined using the methods presented in the previous chapter. Further restrictions on the systems performance are given by the Maximum Sensitivity and Maximum Interaction of the system given by:

\begin{align}
\begin{split}
\ma{H}_{A,Max} &= \begin{bmatrix}
0 & h_{12,Max} \\
h_{21,Max} & 0 
\end{bmatrix}\\
\ma{M}_{S} &= \begin{bmatrix}
M_{S,1} & 0 \\
0 & M_{S,2}
\end{bmatrix}
\end{split}
\label{c:fotd:e:restrictions}
\end{align}

Eq.\ref{c:fotd:e:restrictions} is given under the assumption that only the diagonal transfer functions are requiered and the interaction acts on the antidiagonal entries. Furthermore the system will be operating near steady state and hence the frequency used for Taylor Series Exapnsion is choosen to be $s = 0$.

\subsection{Controller Design via Relative Gain Array Analysis}
\label{c:fotd:su:rga}

Using the RGA as an indicator of interaction, the pairing is choosen to be such that the corresponding element $\Lambda_ij(\ma{G})$ equals the maximum entry of the row. Assuming a sufficient sorting, the structure of the controlller is diagonal as well. The controller are designed via the AMIGO algorithm as presented in Sec.\ref{c:controller:s:AMIGO}.\\

\subsection{Controller Design via Astr\"om et. al.}
\label{c:fotd:su:astrom}

At first the decoupler is designed via the inverse static gain of the system, since the error connected to the steady state measurement can be assumed small with respect to the dynamic error. Hence, the decoupler is given by:

\begin{align}
\begin{split}
\ma{D} &= \ma{G}|_{s=0}^{-1}\\
&= \frac{1}{K_{11}K_{22}-K_{12}K_{21}} 
\begin{bmatrix}
K_{22} & -K_{21} \\
-K_{12} & K_{11}
\end{bmatrix}
\end{split}
\label{c:fotd:e:exampleDecoupler}
\end{align}

The transformed system $\ma{G}^*$ can thus be calculated as

\begin{align}
\begin{split}
\ma{G}^* &= \ma{G}\ma{D}\\
&= \frac{1}{K_{11}K_{22}-K_{12}K_{21}} 
\begin{bmatrix}
g_{11} & g_{12} \\
g_{21} & g_{22}
\end{bmatrix}
\begin{bmatrix}
K_{22} & -K_{21} \\
-K_{12} & K_{11}
\end{bmatrix} \\
&= \frac{1}{K_{11}K_{22}-K_{12}K_{21}}
\begin{bmatrix}
K_{22}g_{11}-K_{12}g_{12} & -K_{21}g_{11}+K_{22}g_{12} \\
K_{22}g_{21}-K_{12}g_{22} &
-K_{21}g_{21}+K_{11}g_{22}
\end{bmatrix}
\end{split}
\label{c:fotd:e:exampletransformed}
\end{align}

From Eq. \ref{c:fotd:e:exampletransformed} it is clear that the entries $g_{ij}^*$ are linear combinations of FOTD transfer functions. Due to the properties of the exponential function the superposition principle does not hold. Hence a controller via the AMIGO algorithm can only be designed if a sufficient approximation of the linear combination as a FOTD can be formulated:

\begin{align}
\begin{split}
g_{ij}^* & = \frac{K_{ij}^*}{T_{ij}^*s+1}e^{-L_{ij}^* s} + \Delta g_{ij}^*\\
&\approx \frac{K_{ij}^*}{T_{ij}^*s+1}e^{-L_{ij}^* s} 
\end{split}
\label{c:fotd:e:exampleFOTDapprox}
\end{align}

Within Eq. \ref{c:fotd:e:exampleFOTDapprox} the main drawback of the method is layed out. As stated earlier, most algorithms for PI(D) design rely on a fixed model structure and hence are not fit to process information given by a combination. To use the function, two methods are proposed.\\

Assuming the results of the experiment used for identifying the process are still avaible the process approximate model can be found via a weighted sum of the systems output. Calculating the static can as proposed in Ch.\ref{c:identification}, the linear combination of the TITO system can be fitted to the resulting weighted measurement data, e.g. given by

\begin{align}
\begin{split}
y_{1}^*(t) &= \frac{K_{22} y_{11}(t) - K_{12} y_{12}(t)}{\det(\ma{K})}
\end{split}
\label{c:fotd:e:Combination}
\end{align}

Eq. \ref{c:fotd:e:Combination} reuses the experimental data to approximate the systems output. $y_{ii}$ is the i-th output of the system reacting to excitation via the i-th input. Hence the data can be used for FOTD model identification as presented earlier. However, this workaround is limited to static decoupling. Hence, a more dynamic assumed decoupling can not be established.\\

The second method relies on knowledge about the behaviour of the transfer functions in the time domain. At first, the static gain is given by:

\begin{align}
\begin{split}
\ma{K}^* &= \lim_{s\mapsto 0} \ma{G}^* \\
&= \ma{K} ~\ma{D} \\
&= \ma{I}
\end{split}
\label{c:fotd:e:CombinationGain}
\end{align}

The integral can be rewritten as

\begin{align}
\begin{split}
\int_0^\infty \ve{y}^*(\infty) - \ve{y}^*(t) dt &= \int_0^\infty \ve{y}(\infty) - \ve{y}(t) dt ~\ma{D} \\
\ma{K}^* \bigotimes \ma{T}_{ar}^{*} &= \ma{K}^* \bigotimes \left( \ma{T}^* + \ma{L}^* \right) \\
&= \left(\ma{K}^* \bigotimes \left( \ma{T} + \ma{L} \right) \right) \ma{D}\\
\end{split}
\label{c:fotd:e:CombinationIntegral}
\end{align}

Where $\bigotimes$ denotes the element wise multiplication, also called Hadamard Product. Since the Hadamard Product relates to the row and column sum, one can rewrite the transformed average residence time for a static decoupler as

\begin{align}
\begin{split}
\sum_{i = 1}^{n_y} \left[ \left(\ma{K} \bigotimes \left( \ma{T} + \ma{L} \right) \right) \ma{D} \right]_{i,j} &= \left[\left(\left( \ma{T} + \ma{L} \right)^T \ma{K}^T \right) \ma{D} \right]_{j,j}\\
&= \left[\left( \ma{T} + \ma{L} \right)^T \ma{\Lambda}^T\left( \ma{G} \right) \right]_{j,j} 
\end{split}
\label{c:fotd:e:AverageResidenceTime_Transform}
\end{align}
 
Eq. \ref{c:fotd:e:AverageResidenceTime_Transform} relates the approximation to the RGA as given in Ch. \ref{c:controller}. Hence, if the influence of the minor diagonals is small, the approximation is sufficiently good.\\

To determine the coefficients of the new system a third equation is needed. It is convinient to choose an appropriate value for the new time delay $L^*$ with several options like a weighted sum, the minimum or maximum of all involved delays. A robust method is given by choosing the maximum and hence implement a conservative tuning. Subsequently Eq. \ref{c:fotd:e:CombinationIntegral} can be rearranged to

\begin{align}
\begin{split}
\ma{T}^* &= \ma{T}_{ar}^* - \ma{L}^* \\
\end{split}
\label{c:fotd:e:CombinationTimeConstant}
\end{align}

Assuming an approximation can be found and the resulting error is sufficiently small the diagonal controller can be designed. A choice for a PI-Structure with set point weighting $b=0$ holds:

\begin{align}
\begin{split}
\ma{K}_y^* &= \begin{bmatrix}
-K_{P1}^* - K_{I1}^*\frac{1}{s} & 0 \\
0 & -K_{P2}^* - K_{I2}^*\frac{1}{s}
\end{bmatrix} \\
\ma{K}_r^* &= \begin{bmatrix}
K_{I1}^*\frac{1}{s} & 0 \\
0 & K_{I2}^*\frac{1}{s}
\end{bmatrix} 
\end{split}
\label{c:fotd:e:exampleTransformedControler}
\end{align}

%\begin{figure}[h]
%  \centering
%  \def\svgwidth{\textwidth}
%  \input{./Graphics/Area_Linear_Combination.pdf_tex}
%\end{figure}

With parameters $K_{P,i},K_{I,i} \in \mathbb{R}$ are calculated via the AMIGO tuning rules described in Sec.\ref{c:controller:s:AMIGO}. Since the approximation given in Eq.\ref{c:fotd:e:exampleFOTDapprox} holds an inevitable error so do the parameter. \\

Next, the interaction will be used to detune the controller. The Taylor series of the antidiagonal entries of the system $\ma{G}^* = \ma{G} \ma{D}$ is given by:

\begin{align}
\begin{split}
\ma{\Gamma}_A &= \left[\frac{d}{ds}\ma{G}|^*_{s=0}\right]_A s \\
&= \begin{bmatrix}
0 & \frac{-K_{21}K_{11}(T_{11}-L_{11}) + K_{22}K_{12}(T_{12}-L{12})}{K_{11}K_{22}-K_{12}K_{21}} \\
\frac{-K_{12}K_{22}(T_{22}-L_{22}) + K_{22}K_{21}(T_{21}-L_{21})}{K_{11}K_{22}-K_{12}K_{21}} & 0
\end{bmatrix} s\\
&\approx \begin{bmatrix}
0 & K_{12}^* (T_{12}^* - L_{12}^*) \\
K_{21}^* (T_{21}^* - L_{21}^*) & 0 
\end{bmatrix} s
\end{split}
\label{c:fotd:e:exampleTransformedCoupling}
\end{align}

From Eq. \ref{c:fotd:e:exampleTransformedCoupling} the dependency of the coupling on the both the static gain of the system and the dynamical behaviour can be observed. This coincides with the statements of \cite{Lunze2014} declaring that static decoupling is in general easier if the dynamic behaviour of the involved transfer functions is similar.\\

Detuning the controller with the constrains on the closed loop given by Eq. \ref{c:fotd:e:restrictions} and solving Eq. \ref{c:controller:e:Hmax*} for the controller with set point holds:

\begin{align}
\begin{split}
\ma{K}^*_r &\leq \ma{\Gamma}^{-*}_{A,Max}\ma{M}_S^{-1}\ma{H}^*_{A,Max} \\ 
&\leq \frac{1}{\det(\ma{M}_S)}\ma{\Gamma}^{-*}_{A,Max}\ma{H}^*_{A,Max}\\
&\leq \frac{1}{M_{S,1}M_{S,2}}
\begin{bmatrix}
\frac{h_{21,Max}}{K_{12}^* (T_{12}^* - L_{12}^*)} & 0\\
0 & \frac{h_{12,Max}}{K_{21}^* (T_{21}^* - L_{21}^*)} 
\end{bmatrix}
\end{split}
\end{align}


\subsection*{Controller Design via Modified Astr\"om}

Now the modified Algorithm proposed in this thesis is applied to the same System. First, we design the controller as a function of the main diagonal entries $g_{ii}$ once again using the AMIGO tuning rules:

\begin{align}
\begin{split}
\ma{K}_y &= \begin{bmatrix}
-K_{P1} - K_{I1}\frac{1}{s} & 0 \\
0 & -K_{P2} - K_{I2}\frac{1}{s}
\end{bmatrix} \\
\ma{K}_r &= \begin{bmatrix}
K_{I1}\frac{1}{s} & 0 \\
0 & K_{I2}\frac{1}{s}
\end{bmatrix} 
\end{split}
\label{c:fotd:e:exampleControler}
\end{align}

The splitter $\ma{\Sigma}$ is likewise designed by the steady state of the system as:

\begin{align}
\begin{split}
\ma{\Sigma} &= \ma{D}_A\ma{D}_D^{-1} \\
& = \begin{bmatrix}
0 & -\frac{K_{12}}{K_{11}} \\
-\frac{K_{21}}{K_{22}} & 0
\end{bmatrix}
\end{split}
\end{align}

To test for interaction define the maximum interaction and the sensitivity like in Eq. \ref{c:fotd:e:restrictions}. The anti diagonal parts of the Taylor series can be calculated to be

\begin{align}
\begin{split}
\ma{\Gamma}_A &= \frac{d}{ds}\left[\ma{G}_A + \ma{G}_D\ma{\Sigma}\right]|_{s=0} \\
&= \begin{bmatrix}
0 & K_{12}(T_{12}-L_{12}) - K_{11}\frac{K_{12}}{K_{11}}(T_{11}-L_{11}) \\
K_{21}(T_{21}-L_{21}) - K_{22}\frac{K_{21}}{K_{22}}(T_{22}-L_{22}) & 0 
\end{bmatrix} \\
&= \begin{bmatrix}
0 & K_{12}(T_{12}-L_{12} - T_{11}+L_{11}) \\
K_{21}(T_{21}-L_{21} - T_{22}+L_{22}) & 0 
\end{bmatrix} 
\end{split}
\end{align}

To detune the controller solving Eq. \ref{c:controller:e:Hmax*} for the integral controller as before holds:

\begin{align}
\begin{split}
\ma{K}_I &\leq \ma{\Gamma}_A^{-1} \ma{M}_S^{-1} \ma{H}_{A,Max} \\
&\leq \frac{1}{\det(\ma{M}_S)} \ma{\Gamma}_A^{-1} \ma{H}_{A,Max} \\
&\leq \frac{1}{M_{S,1}M_{S,2}}\begin{bmatrix}
\frac{h_{12,Max}}{K_{12}(T_{12}-L_{12}-T_{11}+L_{11})} & 0 \\
0 &\frac{h_{21,Max}}{K_{21}(T_{21}-L_{21}-T_{22}+L_{22})}
\end{bmatrix}
\end{split}
\end{align}

Hence, the system is detuned by the FOTD model identified originally at the beginning of the process.

\newpage
\section{Rosenbrocks Function}%
\label{c:fotd:s:rosenbrook}

First, the example of Rosenbrock's Function will be considered. The system is given by

\begin{align}
\begin{split}
\ma{G} &= \begin{bmatrix}
\frac{1}{s+1} & \frac{2}{s+3} \\
\frac{1}{s+1} & \frac{1}{s+1}
\end{bmatrix}
\\
&=\begin{bmatrix}
\frac{1}{s+1} & \frac{\frac{2}{3}}{\frac{1}{3}s+1} \\
\frac{1}{s+1} & \frac{1}{s+1}
\end{bmatrix} 
\end{split}
\label{c:fotd:e:rosenbrock_sys}
\end{align}

The transfer function matrix given in \ref{c:fotd:s:rosenbrook} is delay free. The systems time constants and gains are equal for the transfer functions for the input-output pairing  $(u_1, y_1)$,$(u_1,y_2)$ and $(u_2,y_1)$ all equal $T = \unitfrac[1]{sec}{rad}$ and $K = 1$. The transfer function from input 2 to output 1 has a time constant $T = \unitfrac[\frac{1}{3}]{sec}{rad}$ and a gain of $K = \frac{2}{3}$. Hence,whilst not a influencial with respect to gain, $g_{21}$ is acting faster on $y_1$ than $g_{11}$.\\ 

Rosenbrock's system is a common example. As stated in \cite{Astrom2001a}, it looks easy to control but is not stable, since its characteristic equation given in Eq. \ref{c:fotd:rosenbrock_chareq} has a pole in the right half plane at $s=1$.

\begin{align}
\begin{split}
\det\left( \ma{G} \right) &= \frac{1}{\left( s + 1\right)^2} - \frac{2}{\left( s + 1\right) \left( s + 3\right)}
\end{split}
\label{c:fotd:rosenbrock_chareq}
\end{align}

The system is used as an example in \cite{Astrom2001a}, where a controller has been computed using analytical methods. This controller will serve as a reference to the methods developed in Ch. \ref{c:controller}. 

\subsection{Decentralized Controller}%
\label{c:fotd:s:rosebrock:sub:decentral}

To determine the system input-ouput pairing the RGA of Eq.\ref{c:fotd:e:rosenbrock_sys} at steady state is computed to be:

\begin{align}
\begin{split}
\Lambda(\ma{G})_0 &= \begin{bmatrix}
3 & -2 \\
-2 & 3
\end{bmatrix} 
\end{split}
\label{c:fotd:e:rosenbrock_rga}
\end{align}

The result of Eq.\ref{c:fotd:e:rosenbrock_rga} advices to control the process using the main diagonal of the system. Following this advice, one is able to design the decentralised controller via the AMIGO tuning rules given in Sec. \ref{c:controller:s:AMIGO}. Designing a PI controller by Eq. \ref{c:controller:e:amigo_pi} with the system coefficients gives a diagonal controller with

\begin{align}
\ma{K} &= \ma{K}_P + \frac{1}{s}~ \ma{K}_I\\
&= \begin{bmatrix}
0.725 & 0 \\
0 & 0.725
\end{bmatrix}
+ \frac{1}{s}\begin{bmatrix}
0.852 & 0 \\
0 & 0.852
\end{bmatrix}
\end{align}

With a set-point weight of $ b = 0 $, since $\tau_{ij} = 0 ~\forall i,j \in [1,2]$. The parameter of the controller have been computed using an artificial delay of $L = 0.3~T$, since it enables a more robust tuning.

\subsection{Decoupled Controller based on Astr\"om}%
\label{c:fotd:s:rosebrock:sub:astrom}

At first, the decoupler $\ma{D}$ is designed based on the steady state gain to be 

\begin{align}
\begin{split}
\ma{D} &= \begin{bmatrix}
3 & -2 \\
-3 & 3
\end{bmatrix}
\end{split}
\label{c:fotd:s:rosenbrock:eq:ast_decoupler}
\end{align}

This results in the transformed system $\ma{G}^*$ as given in \cite{Astrom2001a}:

\begin{align}
\begin{split}
\ma{G}^* &= \ma{G} ~\ma{D} \\
&= \begin{bmatrix}
\frac{3\left(1-s\right)}{\left(s+1\right)\left(s+3\right)} & \frac{4~s}{\left(s+1\right)\left(s+3\right)} \\
0 &   \frac{1}{s+1}
\end{bmatrix}
\end{split}
\label{c:fotd:s:rosenbrock:eq:ast_transformed}
\end{align}

From Eq.\ref{c:fotd:s:rosenbrock:eq:ast_transformed} it is easy to see that the influence of input 1 to output 2 is already decoupled. The interaction is therefore zero. This relies on the similarities of the dynamics of $g_{12}$ and $g_{22}$. The first order linearization of $g_{21}^*$ holds:

\begin{align}
\begin{split}
\gamma_{12} &= \frac{d}{ds}\left(g_{21}^*\right) |_{s=0} \\
&= \frac{4}{3}
\end{split}
\label{c:fotd:rosenbrock:eq:ast_interaction}
\end{align}

To design a controller based on the simple tuning rules, the main diagonal transfer functions of the system Eq.\ref{c:fotd:s:rosenbrock:eq:ast_transformed} have to be estimated with a FOTD model. According to Eq. \ref{c:fotd:e:CombinationIntegral}, one can estimate the influence the linear combination of the FOTD model via:

\begin{align}
\begin{split}
\ma{K}^* \bigotimes \ma{T}_{ar}^{*} &= \ma{K}^* \bigotimes \left( \ma{T}^* + \ma{L}^* \right)\\
&=  \left( \ma{K} \bigotimes \left[ \ma{T} + \ma{L} \right] \right) \ma{D} \\
&= \begin{bmatrix} 
2.330 & -1.335 \\ 
0.003 & 0.977	
\end{bmatrix}
\end{split}
\label{c:fotd:s:rosenbrock:eq:ast_approx}
\end{align}


Which is consisting of the steady state gain $\ma{K}^* = \ma{I}$ and the approximate lag of:

\begin{align}
\begin{split}
\ma{T}^* & = \ma{T}_{ar}^* -\cancelto{0}{\ma{L}}^* \\
&= \ma{T}_{ar}^*
\end{split}
\label{c:fotd:s:rosenbrock:eq:ast_lag_approx}
\end{align}

Hence, the approximated, diagonal system is given by 

\begin{align}
\begin{split}
\ma{G}_D^* &\approx \begin{bmatrix}
\frac{1}{2.330~s+1} & 0 \\
0 & \frac{1}{0.977~s+1}
\end{bmatrix}
\end{split}
\label{c:fotd:s:rosenbrock:eq:ast_diag_sys}
\end{align}

The transfer function $g_{22}$ of the approximated system given in Eq.\ref{c:fotd:s:rosenbrock:eq:ast_diag_sys} is almost identical with its real counterpart in Eq.\ref{c:fotd:s:rosenbrock:eq:ast_transformed}. The difference of the first main diagonal entry is however, much more significant. A bode plot of both systems hold\\

FIGURE\\

From FIG the conservative character of the approximation can be seen. With regards to the design of a PI controller this results in an aggressive, more faster controller, since $K_P,~T_I \propto \frac{1}{T}$. The resulting parameter of the controller are calculated to be:

\begin{align}
\ma{K} &= \ma{K}_P + \frac{1}{s}~ \ma{K}_I\\
&= \begin{bmatrix}
0.725 & 0 \\
0 & 0.725
\end{bmatrix}
+ \frac{1}{s}\begin{bmatrix}
1.096 & 0 \\
0 & 0.852
\end{bmatrix}
\end{align}

With a set-point weight of $b = 0$ since $\tau_{ij} = 0 ~\forall i,j \in [1,2]$. For the detuning an upper limit regarding the interaction of the process is required. Since a minimal interaction is desired, the upper limit of the interaction is set to $h_{ij} = 0.01 ~ \forall i,j \in [1,2]$. Iterative detuning of the controller with a decay of $\frac{K_P^{i+1}}{K_P^{i}} = 0.7 $ changes the parameter value to be:

\begin{align}
\ma{K} &= \ma{K}_P + \frac{1}{s}~ \ma{K}_I\\
&= \begin{bmatrix}
0.725 & 0 \\
0 & 0.725
\end{bmatrix}
+ \frac{1}{s}\begin{bmatrix}
0.856 & 0 \\
0 & 0.852
\end{bmatrix}
\end{align}

The parameter values of the controller after detuning are similar to the results of the decentralized controller described above. This similarity arises from  



\subsection{Decoupled Controller based on Modified Astr\"om}
\label{c:fotd:s:rosenbrock:ss:modifiedastr}

\section{Woodberry}%
\label{c:fotd:s:woodberry}

Woodberry Destillation Column as Example!

\section{Identified System at WP 1}%
\label{c:fotd:s:wp1}

Working point 1

\section{Identified System at WP 2}%
\label{c:fotd:s:wp1}

Working point 2

\section{Performance Review} % (fold)
\label{c:fotd:s:performance_review}

\begin{figure}[H]
\begin{minipage}[b]{\textwidth}
\centering
\includegraphics[width=0.9\textwidth]{./Graphics/Step_MATLAB.png}
\caption{Step of the MIMO}
\label{c:fotd:f:mimo_step}
\end{minipage}
\end{figure}

